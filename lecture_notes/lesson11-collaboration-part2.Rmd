---
title: "Lesson 11: Collaborating with GitHub - Part 2"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<br>

# Work in progress

## Readings

Read through the tutorial in [Chapters 9.5 - 9.7 in R for Excel Users](https://rstudio-conf-2020.github.io/r-for-excel/collaborating.html#collaborating-with-github) by Julia Lowndes and Allison Horst. We will walk through a very similar workflow together.

<br>

## Other resources

[HappyGitwithR](https://happygitwithr.com/) by Jenny Bryan

Tutorials about gh-pages
https://pages.github.com/

https://jules32.github.io/rmarkdown-website-tutorial/index.html

Tutorial on making websites with GitHub pages by Karl Broman (https://kbroman.org/simple_site/)

Watch the video here https://pages.github.com/


## Plan for today

We will continue working through the tutorial we started on last time. Because we may not have both members of all pairs with us today, we will form new pairs and start over with setting up a new shared repo that we both have cloned to our local computers. It's good to keep practicing that setup, and we'll quickly get back to where we left off.

Step by step instructions are on the [slides](XX)


## Learning objectives
We will work through a simple setup
Then discuss some of the more advanced features that you may start using as you get more comfortable

Set up a collaborative repo
Take turns to make changes with a partner
Understand how to avoid merge conflicts
Resolve merge conflicts
Check out an earlier version of a script
Set up a free website through RStudio with GitHub pages
Apply basic design and styling of a GitHub pages website

<br>

## Getting set up
Because everyone will have a new partner today, we'll practice again the initial creation of a new repo, creation of a gh-pages branch (that will let us create a website) within that repo, invite a collaborator and both clone the collaborative repo to your local machines following sections 9.2 through 9.6 in the [Ocean Health Index Data Science Training Tutorial](http://ohi-science.org/data-science-training/collaborating.html).

Make sure Partner 2 doesn't clone the repo until Partner 1 has pushed their .RProj file to avoid complex merge conflicts here.

We will now demo a series of different outcomes we can experience when two people are working on the same repo and end up making changes in parallel without pushing in sequence (i.e. partners end up with different versions on their local computers that need to be reconciled in the remote repo). We will show this as part of the process of setting up our collaborative website. Watch first, then you'll get a chance to work through the steps for yourselves.


Scenario: You want to pull changes from upstream, but you have done some new work locally since the last time you pulled. This often comes up because what you actually want to do is push, but Git won’t let you until you first incorporate the upstream changes.

State of repo on GitHub
```{r}
A--B--C
```

State of repo on your local computer
```{r}
A--B--D
```

You can’t cause some sort of merge to happen to the GitHub copy when you push.

Instead, you’ve got pull the commit C and somehow integrate it into your D-containing history. Then you will be able to push again.


#### When you have worked on separate files 

Let's have Partner 2 create a new RMarkdown file. Here's what they will do: 

1. Pull!
1. Create a new RMarkdown file, just keep all the boilerplate text **and save it as `index.Rmd`**. Make sure it's all lowercase, and named `index.Rmd`. This will be the homepage for our website! 
1. Maybe change the title inside the Rmd, call it "Our website"
1. Knit!
1. Save and sync your .Rmd and your .html files 
    - (pull, stage, commit, pull, push)
1. Go to GitHub.com and go to your rendered website! Where is it? Figure out your website's url from your github repo's url. For example: 
    - my github repo: <https://github.com/jules32/collab-research>
    - my website url: <https://jules32.github.io/collab-research/>
    - note that the url starts with my **username.github.io**
    
So cool! On websites, if something is called `index.html`, that defaults to the home page. So <https://jules32.github.io/collab-research/> is the same as <https://jules32.github.io/collab-research/index.html>. If you name your RMarkdown file `my_research.Rmd`, the url will become <https://jules32.github.io/collab-research/my_research.html>.

Now, let's have Partner 1 edit the README file. Then try to pull. Then stage, commit, push.

The versions should merge smoothly because there is no overlap between the changes made by Partner 1 and 2.

Summary:
```{r}
                 Remote: A--B--C

Local before 'git pull': A--B--(uncommitted changes)
Local after 'git pull': A--B--C--(uncommitted changes)
```

<br>

#### When you have worked in different parts of the same file 

Now you both have a copy of the `index.Rmd` file. Partner 2 can add a new header just under the setup code chunk (e.g. line 12), then pull, stage, commit, push.
Now Partner 1 can add a note under the `## Including Plots` header around line 22. Then try to pull. Then commit, and pull, stage, push.

Again, this time the versions should merge smoothly because we were working in different parts of the document.

<br>

#### When you have worked on the same part of a file
Now Partner 2 makes a change to the first code chunk. Change `summary(cars)` to a different function, e.g. `dim(cars)`. Then pull, stage, commit, push

Partner 1 should no pull yet, but instead also make a change to that first code chunk, so change `summary(cars)`, e.g. to `nrow(cars)`. Then try to pull (will be rejected). Then stage, commit and pull. 

This will result in a merge conflict. Resolve as described in Section 9.9 [here](http://ohi-science.org/data-science-training/collaborating.html#merge-conflicts).



## Your turn
1. Have Partner 2 make and knit the `index.Rmd` file as described above, and push it to GitHub (pull, stage, commit, push)
1. Check that your website is working
1. Partner 1 should pull to make sure they get a local copy of the `index.Rmd` file
1. Now each of you find an image online that you'd like to add (maybe a picture of a car?). Right click on it and select "copy image address". The add it to the top of the `index.Rmd` with 
`![](url-to-image). Then knit the file.
1. First Partner 1 should now push their changes to GitHub (pull, stage, commit, push)
1. Then Partner 2 should try to push (pull, stage, commit, push). Do you get a merge conflict? Why / why not? If you got a merge conflict, Partner 2 should resolve it and push to GitHub
1. Partner 1 should pull to make sure you're both up to date


<br>

## Jazzing up your website

Now let's explore how we can expand our website by adding more tabs. We'll start with simple example of a website that includes two pages (Cars and About) and a navigation bar to switch between them. For that, we need a configuration file _site.yml:

```{r}
name: "my-website"
navbar:
  title: "Our Collaborative Website"
  left:
    - text: "Cars"
      href: index.html
    - text: "About"
      href: about.html
output_dir: "."
```

Partner 2 can create this file by choosing File -> New File -> Text File in RStudio, copy in the above text and save as `_site.yml` (the leading underscore is important here).

Then we need the two `.html` files that are going to be shown on the tabs. We already have `index.html` (our knitted version of the boilerplate .Rmd file we have played around with).

We need to create the `about.html`. Partner 1 can create a new RMarkdown (File -> New File -> R Markdown...), change its title to "About", delete all the boilerplate text under the setup code chunk and write a brief message about the two of you. 

Now you can both pull, stage, commit, push and your changes should merge. Make sure you both get up to date by pulling after you have both pushed.

Now you're ready to build your website.

From [R Markdown: The Definitely Guide](https://bookdown.org/yihui/rmarkdown/rmarkdown-site.html#a-simple-example):

> Note that the minimum requirement for any R Markdown website is that it have an index.Rmd file as well as a _site.yml file. If you execute the `rmarkdown::render_site()` function from within the directory containing the website, the following will occur:

> All of the *.Rmd and *.md files in the root website directory will be rendered into HTML. Note, however, that Markdown files beginning with _ are not rendered (this is a convention to designate files that are to be included by top level Rmd documents as child documents).

> The generated HTML files and any supporting files (e.g., CSS and JavaScript) are copied into an output directory (_site by default). [Note that in our example we are asking to get our output in the top-level of the directory with `output_dir: "."`]

>The HTML files within the _site directory are now ready to deploy as a standalone static website.

>The full source code for the simple example above can be found in the hello-website folder in the repository https://github.com/rstudio/rmarkdown-website-examples.


Partner 1 can now build the website by running `rmarkdown::render_site()`

Commit and push

Both Partners: Go to inspect your rendered website! 
Remember the format of the URL:
For example: 
    - my github repo: <https://github.com/jules32/collab-research>
    - my website url: <https://jules32.github.io/collab-research/>
    - note that the url starts with my **username.github.io**

Note that it may take a few minutes before your changes become active.

<br>

## Adding content and editing the website

Now, we want to add a table of contents and change the appearance of our website. We can do this by changing the configuration file. Decide who of you will make the following changes, render the website again, and push.

Update your `_site.yml` file to:

```{r}
name: "my-website"
navbar:
  title: "Our Collaborative Website"
  left:
    - text: "Cars"
      href: index.html
    - text: "About"
      href: about.html
output_dir: "."
output:
  html_document:
    theme: cerulean
    highlight: textmate
    toc: true 
    toc_float: true 
```

Note that we have changed the output theme and added a table of contents.

Again, it will probably take a few minutes for your changes to become active on your github.io page. In the meantime, you can explore your current website content and design in RStudio's Viewer in the bottom left pane. Make sure that the Partner who didn't chance the `_site.yml` file pulls the updated version from GitHub.

Now play around with making additional changes to your website. You can change the theme. 
> The valid options to choose include default, cerulean, journal, flatly, darkly, readable, spacelab, united, cosmo, lumen, paper, sandstone, simplex, and yeti.

You can preview what each of these look like under the "themes" tab [here](https://bootswatch.com/3/). Discuss with your Partner which one you want to try next and who will be pushing the next edits.

You can also play around with the table of contents. For the table of contents, you can specify what levels of headers you want include as described [here](https://bookdown.org/yihui/rmarkdown/html-document.html#table-of-contents). In our initial `_site.yml` file, the table of contents depth is not explicitly specified, so it defaults to 3 (meaning that all level 1, 2, and 3 headers will be included in the table of contents). Try adding some header levels to your index.Rmd or about.Rmd and see how the table of contents change when you render the site and push the change to your github.io site (the Viewer may not properly display all levels of the table of contents, but the github.io site should).

You can also try adding another tab, either with a new .Rmd file you create or for example adding your most recent homework or another analysis file you have on hand.



